<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lightning Fast Serialization of Data Frames • fst</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Lightning Fast Serialization of Data Frames">
<meta property="og:description" content="Multithreaded serialization of compressed data frames using the
    fst format. The fst format allows for random access of stored data and
    compression with the LZ4 and ZSTD compressors created by Yann Collet. The ZSTD
    compression library is owned by Facebook Inc.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">fst</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/fstpackage/fst/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<p><img src="fst.png" align="right" height="196" width="196"></p>
<p><a href="https://travis-ci.org/fstpackage/fst"><img src="https://travis-ci.org/fstpackage/fst.svg?branch=develop" alt="Linux/OSX Build Status"></a> <a href="https://ci.appveyor.com/project/fstpackage/fst/branch/develop"><img src="https://ci.appveyor.com/api/projects/status/6g6kp8onpb26jhnm/branch/develop?svg=true" alt="Windows Build status"></a> <a href="https://www.gnu.org/licenses/agpl-3.0"><img src="https://img.shields.io/badge/License-AGPL%20v3-blue.svg" alt="License: AGPL v3"></a> <a href="https://cran.r-project.org/package=fst"><img src="http://www.r-pkg.org/badges/version/fst" alt="CRAN_Status_Badge"></a> <a href="https://codecov.io/gh/fstpackage/fst"><img src="https://codecov.io/gh/fstpackage/fst/branch/develop/graph/badge.svg" alt="codecov"></a> <a href="http://cran.rstudio.com/web/packages/fst/index.html"><img src="http://cranlogs.r-pkg.org/badges/fst" alt="downloads"></a> <a href="http://cran.rstudio.com/web/packages/fst/index.html"><img src="https://cranlogs.r-pkg.org/badges/grand-total/fst" alt="total_downloads"></a></p>
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>The <a href="https://github.com/fstpackage/fst"><em>fst</em> package</a> for R provides a fast, easy and flexible way to serialize data frames. With access speeds of multiple GB/s, <em>fst</em> is specifically designed to unlock the potential of high speed solid state disks that can be found in most modern computers. Data frames stored in the <em>fst</em> format have full random access, both in column and rows.</p>
<p>The figure below compares the read and write performance of the <em>fst</em> package to various alternatives.</p>
<table class="table">
<thead><tr class="header">
<th align="left">Method</th>
<th align="left">Format</th>
<th align="left">Time (ms)</th>
<th align="left">Size (MB)</th>
<th align="left">Speed (MB/s)</th>
<th align="left">N</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">readRDS</td>
<td align="left">bin</td>
<td align="left">1577</td>
<td align="left">1000</td>
<td align="left">633</td>
<td align="left">112</td>
</tr>
<tr class="even">
<td align="left">saveRDS</td>
<td align="left">bin</td>
<td align="left">2042</td>
<td align="left">1000</td>
<td align="left">489</td>
<td align="left">112</td>
</tr>
<tr class="odd">
<td align="left">fread</td>
<td align="left">csv</td>
<td align="left">2925</td>
<td align="left">1038</td>
<td align="left">410</td>
<td align="left">232</td>
</tr>
<tr class="even">
<td align="left">fwrite</td>
<td align="left">csv</td>
<td align="left">2790</td>
<td align="left">1038</td>
<td align="left">358</td>
<td align="left">241</td>
</tr>
<tr class="odd">
<td align="left">read_feather</td>
<td align="left">bin</td>
<td align="left">3950</td>
<td align="left">813</td>
<td align="left">253</td>
<td align="left">112</td>
</tr>
<tr class="even">
<td align="left">write_feather</td>
<td align="left">bin</td>
<td align="left">1820</td>
<td align="left">813</td>
<td align="left">549</td>
<td align="left">112</td>
</tr>
<tr class="odd">
<td align="left"><strong>read_fst</strong></td>
<td align="left"><strong>bin</strong></td>
<td align="left"><strong>457</strong></td>
<td align="left"><strong>303</strong></td>
<td align="left"><strong>2184</strong></td>
<td align="left"><strong>282</strong></td>
</tr>
<tr class="even">
<td align="left"><strong>write_fst</strong></td>
<td align="left"><strong>bin</strong></td>
<td align="left"><strong>314</strong></td>
<td align="left"><strong>303</strong></td>
<td align="left"><strong>3180</strong></td>
<td align="left"><strong>291</strong></td>
</tr>
</tbody>
</table>
<p>These benchmarks were performed on a laptop (i7 4710HQ @2.5 GHz) with a reasonably fast SSD (M.2 Samsung SM951) using the dataset defined below. Parameter <em>Speed</em> was calculated by dividing the in-memory size of the data frame by the measured time. These results are also visualized in the following graph:</p>
<p><img src="README-speed-bench-1.png"><!-- --></p>
<p>As can be seen from the figure, the measured speeds for the <em>fst</em> package are very high and even top the maximum drive speed of the SSD used. The package accomplishes this by an effective combination of multi-threading and compression. The on-disk file sizes of <em>fst</em> files are also much smaller than that of the other formats tested. This is an added benefit of <em>fst</em>’s use of type-specific compressors on each stored column.</p>
<p>In addition to methods for data frame serialization, <em>fst</em> also provides methods for multi-threaded in-memory compression with the popular LZ4 and ZSTD compressors and an extremely fast multi-threaded hasher.</p>
</div>
<div id="multi-threading" class="section level2">
<h2 class="hasAnchor">
<a href="#multi-threading" class="anchor"></a>Multi-threading</h2>
<p>The <em>fst</em> package relies heavily on multi-threading to boost the read- and write speed of data frames. To maximize throughput, <em>fst</em> compresses and decompresses data <em>in the background</em> and tries to keep the disk busy writing and reading data at the same time.</p>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>The easiest way to install the package is from CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"fst"</span>)</pre></div>
<p>You can also use the development version from GitHub:</p>
<div class="sourceCode" id="cb2"><pre class="r"><span class="co"># install.packages("devtools")</span>
<span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span>(<span class="st">"fstPackage/fst"</span>, <span class="kw">ref</span> <span class="kw">=</span> <span class="st">"develop"</span>)</pre></div>
</div>
<div id="basic-usage" class="section level2">
<h2 class="hasAnchor">
<a href="#basic-usage" class="anchor"></a>Basic usage</h2>
<p>Using <em>fst</em> is simple. Data can be stored and retrieved using methods <em>write_fst</em> and <em>read_fst</em>:</p>
<div class="sourceCode" id="cb3"><pre class="r"><span class="co"># Generate some random data frame with 10 million rows and various column types</span>
<span class="no">nr_of_rows</span> <span class="kw">&lt;-</span> <span class="fl">1e7</span>

<span class="no">df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
    <span class="kw">Logical</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">TRUE</span>, <span class="fl">FALSE</span>, <span class="fl">NA</span>), <span class="kw">prob</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.85</span>, <span class="fl">0.1</span>, <span class="fl">0.05</span>), <span class="no">nr_of_rows</span>, <span class="kw">replace</span> <span class="kw">=</span> <span class="fl">TRUE</span>),
    <span class="kw">Integer</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fl">1L</span>:<span class="fl">100L</span>, <span class="no">nr_of_rows</span>, <span class="kw">replace</span> <span class="kw">=</span> <span class="fl">TRUE</span>),
    <span class="kw">Real</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fl">1</span>:<span class="fl">10000</span>, <span class="fl">20</span>) / <span class="fl">100</span>, <span class="no">nr_of_rows</span>, <span class="kw">replace</span> <span class="kw">=</span> <span class="fl">TRUE</span>),
    <span class="kw">Factor</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/labels.html">labels</a></span>(<span class="no">UScitiesD</span>), <span class="no">nr_of_rows</span>, <span class="kw">replace</span> <span class="kw">=</span> <span class="fl">TRUE</span>))
  )

<span class="co"># Store the data frame to disk</span>
  <span class="fu"><a href="reference/write_fst.html">write.fst</a></span>(<span class="no">df</span>, <span class="st">"dataset.fst"</span>)

<span class="co"># Retrieve the data frame again</span>
  <span class="no">df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/write_fst.html">read.fst</a></span>(<span class="st">"dataset.fst"</span>)</pre></div>
<p><em>Note: the dataset defined in this example code was also used to obtain the benchmark results shown in the introduction.</em></p>
</div>
<div id="random-access" class="section level2">
<h2 class="hasAnchor">
<a href="#random-access" class="anchor"></a>Random access</h2>
<p>The <em>fst</em> file format provides full random access to stored datasets. You can retrieve a selection of columns and rows with:</p>
<div class="sourceCode" id="cb4"><pre class="r">  <span class="no">df_subset</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/write_fst.html">read.fst</a></span>(<span class="st">"dataset.fst"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Logical"</span>, <span class="st">"Factor"</span>), <span class="kw">from</span> <span class="kw">=</span> <span class="fl">2000</span>, <span class="kw">to</span> <span class="kw">=</span> <span class="fl">5000</span>)</pre></div>
<p>This reads rows 2000 to 5000 from columns <em>Logical</em> and <em>Factor</em> without actually touching any other data in the stored file. That means that a subset can be read from file <strong>without reading the complete file first</strong>. This is different from, say, <em>readRDS</em> or <em>read_feather</em> where you have to read the complete file or column before you can make a subset.</p>
</div>
<div id="compression" class="section level2">
<h2 class="hasAnchor">
<a href="#compression" class="anchor"></a>Compression</h2>
<p>For compression the excellent and speedy <a href="https://github.com/lz4/lz4">LZ4</a> and <a href="https://github.com/facebook/zstd">ZSTD</a> compression algorithms are used. These compressors (in combination with type-specific bit filters), enable <em>fst</em> to achieve high compression speeds at reasonable compression factors. The compression factor can be tuned from 0 (minimum) to 100 (maximum):</p>
<div class="sourceCode" id="cb5"><pre class="r"><span class="fu"><a href="reference/write_fst.html">write.fst</a></span>(<span class="no">df</span>, <span class="st">"dataset.fst"</span>, <span class="fl">100</span>)  <span class="co"># use maximum compression</span></pre></div>
<p>Compression reduces the size of the <em>fst</em> file that holds your data. But because the (de-)compression is done <em>on background threads</em>, it can increase the total read- and write speed as well. The graph below shows how the use of multiple threads enhances the read and write speed of our sample dataset.</p>
<p><img src="README-multi-threading-1.png"><!-- --></p>
<p>The <em>csv</em> format used by the <em>fread</em> and <em>fwrite</em> methods of package <em>data.table</em> is actually a human-readable text format and not a binary format. Normally, binary formats would be much faster than the <em>csv</em> format, because <em>csv</em> takes more space on disk, is row based, uncompressed and needs to be parsed into a computer-native format to have any meaning. So any serializer that’s working on <em>csv</em> has an enormous disadvantage as compared to binary formats. Yet, the results show that <em>data.table</em> is on par with binary formats and when more threads are used, it can even be faster. Because of this impressive performance, it was included in the graph for comparison.</p>
</div>
<div id="bindings-in-other-languages" class="section level2">
<h2 class="hasAnchor">
<a href="#bindings-in-other-languages" class="anchor"></a>Bindings in other languages</h2>
<p><strong>Julia</strong>: <a href="https://github.com/xiaodaigh/FstFileFormat.jl"><strong><code>FstFileFormat.jl</code></strong></a> A naive Julia binding using RCall.jl</p>
<blockquote>
<p><strong>Note to users</strong>: From CRAN release v0.8.0, the <em>fst</em> format is stable and backwards compatible. That means that all <em>fst</em> files generated with package v0.8.0 or later can be read by future versions of the package.</p>
</blockquote>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=fst">https://​cloud.r-project.org/​package=fst</a>
</li>
<li>Browse source code at <br><a href="https://github.com/fstpackage/fst/">https://​github.com/​fstpackage/​fst/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/fstpackage/fst/issues">https://​github.com/​fstpackage/​fst/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://www.r-project.org/Licenses/AGPL-3">AGPL-3</a> | file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>
<div class="community">
<h2>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Mark Klik <br><small class="roles"> Author, maintainer, copyright holder </small>  </li>
<li><a href="authors.html">All authors...</a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p>Developed by Mark Klik.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
